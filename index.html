<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>é¸æ“‡ä½ æƒ³è¦çš„æ–™ç†</title>
<style>
  .grid {
    display: grid;
    grid-template-columns: repeat(4, 150px);
    gap: 10px;
    margin-top: 20px;
  }
  .item {
    padding: 20px;
    border: 2px solid gray;
    text-align: center;
    font-size: 18px;
  }
  .active {
    border-color: red;
    background-color: lightyellow;
  }
</style>
</head>
<body>
  <h1 id="title">é¸æ“‡ä½ æƒ³è¦çš„æ–™ç†</h1>
  <div id="menu" class="grid"></div>
  <h2 id="selection"></h2>
  <div id="suggestion" style="margin-top:20px; font-size:18px; color:green;"></div>

<script defer>
document.addEventListener('DOMContentLoaded', () => {
const categories = {
  "å°å¼æ–™ç†": ["æ»·è‚‰é£¯", "èšµä»”ç…", "é¹½é…¥é›"],
  "æ—¥å¼æ–™ç†": ["å£½å¸", "æ‹‰éºµ", "å®šé£Ÿ"],
  "éŸ“å¼æ–™ç†": ["çŸ³é‹æ‹Œé£¯", "çƒ¤è‚‰", "æ³¡èœé‹"],
  "ç¾å¼æ–™ç†": ["æ¼¢å ¡", "ç‰›æ’", "ç‚¸é›"],
  "æ³°å¼æ–™ç†": ["æ‰“æ‹‹è±¬", "ç¶ å’–å“©", "æœˆäº®è¦é¤…"],
  "è¶Šå¼æ–™ç†": ["æ²³ç²‰", "æ˜¥æ²", "è¶Šå¼ä¸‰æ˜æ²»"],
  "ç¾©å¼æ–™ç†": ["ç¾©å¤§åˆ©éºµ", "æŠ«è–©", "ç‡‰é£¯"],
  "æ¸¯å¼æ–™ç†": ["ç‡’è‡˜", "æ¸¯é»", "è…¸ç²‰"],
  "ä¸­å¼æ–™ç†": ["æ°´ç…®é­š", "å®®ä¿é›ä¸", "ç‚’éºµ"],
  "å°å°¼æ–™ç†": ["ç‚’é£¯", "æ²™å—²", "ç‰›è‚‰æ¹¯"],
  "è²å¾‹è³“æ–™ç†": ["ç‡‰è±¬è‚‰", "çƒ¤é›", "é…¸æ¹¯"],
  "å°åº¦æ–™ç†": ["å’–å“©", "çƒ¤é¤…", "é¦™æ–™é£¯"],
  "å¢¨è¥¿å“¥æ–™ç†": ["æ²é¤…", "å¡”å¯", "ç‰ç±³ç‰‡"],
  "è”¬é£Ÿæ–™ç†": ["è”¬èœç›¤", "æ¤ç‰©è‚‰", "ç´ ä¾¿ç•¶"],
  "åœ°ä¸­æµ·æ–™ç†": ["çƒ¤ç¾Šè‚‰", "æ©„æ¬–æ²™æ‹‰", "æµ·é®®é£¯"],
  "æ³•å¼æ–™ç†": ["å¯éº—é¤…", "ç´…é…’ç‡‰ç‰›è‚‰", "éµè‚é†¬"],
  "è¥¿ç­ç‰™æ–™ç†": ["æµ·é®®ç‡‰é£¯", "Tapas", "ç‡’çƒ¤"],
  "å¥åº·é¤": ["ä½é†£ä¾¿ç•¶", "é«˜è›‹ç™½é›èƒ¸", "æ²™æ‹‰"],
  "ç”œé»é£²å“": ["å¥¶èŒ¶", "åˆ¨å†°", "è±†èŠ±"]
};

let menuLevel = 'main';
let currentIndex = 0;
let mainKeys = Object.keys(categories);
let subKeys = [];
let selectedCategory = "";

function renderMenu(items) {
  const menu = document.getElementById("menu");
  menu.innerHTML = '';
  items.forEach((item, index) => {
    const div = document.createElement('div');
    div.className = 'item' + (index === currentIndex ? ' active' : '');
    div.innerText = item;
    menu.appendChild(div);
  });
}

function updateFocus(direction) {
  const items = (menuLevel === 'main') ? mainKeys : subKeys;
  const cols = 4;
  const rows = Math.ceil(items.length / cols);
  const x = currentIndex % cols;
  const y = Math.floor(currentIndex / cols);

  switch(direction) {
    case 'LEFT': if (x > 0) currentIndex--; break;
    case 'RIGHT': if (x < cols - 1) currentIndex++; break;
    case 'UP': if (y > 0) currentIndex -= cols; break;
    case 'DOWN': if (y < rows - 1) currentIndex += cols; break;
  }

  if (currentIndex < 0) currentIndex = 0;
  if (currentIndex >= items.length) currentIndex = items.length - 1;
  renderMenu(items);
}

function confirmSelection() {
  if (menuLevel === 'main') {
    selectedCategory = mainKeys[currentIndex];
    subKeys = categories[selectedCategory];
    currentIndex = 0;
    menuLevel = 'sub';
    document.getElementById("title").innerText = `è«‹é¸æ“‡ ${selectedCategory} å­åˆ†é¡`;
    renderMenu(subKeys);
  } else if (menuLevel === 'sub') {
    const selectedSub = subKeys[currentIndex];
    document.getElementById("selection").innerText = `ä½ é¸æ“‡çš„æ˜¯ï¼š${selectedCategory} â†’ ${selectedSub}`;
    ws.send(JSON.stringify({ category: selectedCategory, sub: selectedSub }));
  }
}

function rejectSelection() {
  if (menuLevel === 'sub') {
    menuLevel = 'main';
    currentIndex = 0;
    document.getElementById("title").innerText = `é¸æ“‡ä½ æƒ³è¦çš„æ–™ç†`;
    document.getElementById("suggestion").innerText = '';
    document.getElementById("selection").innerText = '';
    renderMenu(mainKeys);
  } else {
    document.getElementById("selection").innerText = `è«‹é‡æ–°é¸æ“‡`;
  }
}

let ws = new WebSocket("ws://localhost:8000/ws");

ws.onopen = () => {
  console.log("âœ… WebSocket é€£ç·šæˆåŠŸï¼");
};

ws.onerror = (error) => {
  console.error("âŒ WebSocket éŒ¯èª¤ï¼š", error);
};

ws.onmessage = (event) => {
  const command = event.data;
  console.log("ğŸ’¬ æ”¶åˆ°æŒ‡ä»¤ï¼š", command);
  if (["UP", "DOWN", "LEFT", "RIGHT"].includes(command)) {
    updateFocus(command);
  } else if (command === 'CONFIRM') {
    confirmSelection();
  } else if (command === 'REJECT') {
    rejectSelection();
  } else {
    document.getElementById("suggestion").innerText = command;
  }
};

renderMenu(mainKeys);
});
</script>
</body>
</html>
